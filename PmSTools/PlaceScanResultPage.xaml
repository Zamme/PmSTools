<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"

             x:Class="PmSTools.PlaceScanResultPage"
             Title="Place Scan Result">
    <!-- toolbar: quick full-screen map action -->
    <ContentPage.ToolbarItems>
        <ToolbarItem Text="Full map" Clicked="FullScreenMap_ToolbarClicked" Priority="0"/>
    </ContentPage.ToolbarItems>

    <Grid RowDefinitions="Auto,*" Padding="0">
        <!-- Header with Back Button -->
        <Grid Padding="10" ColumnDefinitions="Auto,*,Auto" BackgroundColor="Black">
            <Label Text="Place Details" 
                   FontSize="20" 
                   FontAttributes="Bold"
                   Grid.Column="0"
                   HorizontalTextAlignment="Center"
                   VerticalTextAlignment="Center"/>
        </Grid>

        <!-- Content Area -->
        <ScrollView Grid.Row="1">
            <StackLayout Padding="15" Spacing="10">
                <!-- Place Information -->
                <Label Text="Place Information" 
                       FontSize="18" 
                       FontAttributes="Bold"
                       Margin="0,10,0,5"/>
                
                <Label x:Name="NameResultText"
                    Text="Name"
                    FontSize="14"
                    FontAttributes="Bold"
                    Margin="10,0"/>
                
                <Label x:Name="StreetNameResultText"
                    Text="Street Name"
                    FontSize="14"
                    Margin="10,0"/>

                <Label x:Name="StreetNumberResultText"
                    Text="Street Number"
                    FontSize="14"
                    Margin="10,0"/>
                
                <Label x:Name="PostalCodeResultText"
                    Text="Postal Code"
                    FontSize="14"
                    Margin="10,0"/>
                
                <Label x:Name="CityResultText"
                    Text="City"
                    FontSize="14"
                    Margin="10,0"/>
                
                <Label x:Name="CountryResultText"
                    Text="Country"
                    FontSize="14"
                    Margin="10,0"/>

                <Button x:Name="EditFieldsButton"
                        Text="Edit fields"
                        Clicked="EditFieldsButton_Clicked"
                        Margin="0,8,0,0"/>

                <Button x:Name="RepeatPhotoButton"
                    Text="Repeat photo"
                    Clicked="RepeatPhotoButton_Clicked"
                    Margin="0,8,0,0"/>

                <StackLayout x:Name="EditableFieldsPanel" IsVisible="False" Spacing="8" Margin="0,6,0,0">
                    <Label Text="Manual correction" FontAttributes="Bold" FontSize="16"/>

                    <Entry x:Name="EditNameEntry" Placeholder="Name"/>
                    <Entry x:Name="EditStreetNameEntry" Placeholder="Street name"/>
                    <Entry x:Name="EditStreetNumberEntry" Placeholder="Street number"/>
                    <Entry x:Name="EditPostalCodeEntry" Placeholder="Postal code" Keyboard="Numeric"/>
                    <Entry x:Name="EditCityEntry" Placeholder="City"/>
                    <Entry x:Name="EditCountryEntry" Placeholder="Country"/>

                    <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                        <Button Grid.Column="0"
                                x:Name="ApplyEditsButton"
                                Text="Apply corrections"
                                Clicked="ApplyEditsButton_Clicked"/>
                        <Button Grid.Column="1"
                                x:Name="CancelEditsButton"
                                Text="Cancel"
                                Clicked="CancelEditsButton_Clicked"/>
                    </Grid>
                </StackLayout>

                <!-- Location selector (native, below place info) -->
                <Label Text="Location candidates" FontSize="16" FontAttributes="Bold" Margin="0,12,0,6"/>
                <CollectionView x:Name="CandidatesList"
                                SelectionMode="Single"
                                HeightRequest="220"
                                ItemSizingStrategy="MeasureAllItems"
                                SelectionChanged="CandidatesList_SelectionChanged">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Grid Padding="8" ColumnDefinitions="*" RowDefinitions="Auto">
                                <StackLayout Grid.Column="0" Spacing="4">
                                    <Label Text="{Binding DisplayName}"
                                           FontAttributes="Bold"
                                           LineBreakMode="WordWrap"/>
                                    <Label Text="{Binding Type}"
                                           FontSize="12"
                                           LineBreakMode="WordWrap"/>
                                </StackLayout>
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <!-- Map Section -->
                <Label Text="Location Map" 
                       FontSize="18" 
                       FontAttributes="Bold"
                       Margin="0,20,0,5"/>
                
                <StackLayout Orientation="Horizontal" Spacing="15" Padding="0,0,0,10">
                    <Label Text="Latitude:" FontAttributes="Bold" VerticalOptions="Center"/>
                    <Label x:Name="LatitudeText" Text="—" VerticalOptions="Center"/>
                    <Label Text="Longitude:" FontAttributes="Bold" VerticalOptions="Center" Margin="20,0,0,0"/>
                    <Label x:Name="LongitudeText" Text="—" VerticalOptions="Center"/>
                </StackLayout>

                <Grid HeightRequest="400">
                    <WebView x:Name="OsmMap" Navigating="OsmMap_Navigating"
                        HorizontalOptions="Fill"
                        VerticalOptions="Fill" />

                    <!-- Floating full-screen button -->
                    <Button Text="⤢" SemanticProperties.Hint="Open map full screen" Clicked="FullScreenButton_Clicked"
                            BackgroundColor="#80000000" TextColor="White" WidthRequest="48" HeightRequest="48"
                            CornerRadius="24" FontSize="20"
                            HorizontalOptions="End" VerticalOptions="Start" Margin="10"/>
                </Grid>
            </StackLayout>
        </ScrollView>
    </Grid>
</ContentPage>
